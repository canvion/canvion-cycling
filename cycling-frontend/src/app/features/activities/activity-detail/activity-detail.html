<div class="layout">

  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-logo">ğŸš´ Canvion</div>
    <nav>
      <a routerLink="/dashboard" class="nav-item">ğŸ“Š Dashboard</a>
      <a routerLink="/activities" class="nav-item">ğŸƒ Actividades</a>
      <a routerLink="/records" class="nav-item">ğŸ† RÃ©cords</a>
      <a routerLink="/stats" class="nav-item">ğŸ“ˆ EstadÃ­sticas</a>
    </nav>
    <div class="sidebar-bottom">
      <span class="sidebar-user">ğŸ‘¤ {{ username }}</span>
      <button class="btn-logout" (click)="logout()">Salir</button>
    </div>
  </aside>

  <!-- Contenido principal -->
  <main class="main">

    <!-- Loading -->
    <app-spinner *ngIf="isLoading"></app-spinner>

    <div *ngIf="!isLoading && activity">

      <!-- Header -->
      <div class="top-bar">
        <div class="top-left">
          <a routerLink="/activities" class="btn-back">â† Volver</a>
          <h1>{{ activity.name }}</h1>
        </div>
        <span class="badge">{{ activity.isManual ? 'Manual' : 'Strava' }}</span>
      </div>

      <!-- Info bÃ¡sica -->
      <div class="info-bar">
        <span>{{ getIcon(activity.type) }} {{ activity.type }}</span>
        <span>ğŸ“… {{ activity.startDate | date:'dd/MM/yyyy HH:mm' }}</span>
        <span *ngIf="activity.description">ğŸ“ {{ activity.description }}</span>
      </div>

      <!-- MÃ©tricas principales -->
      <div class="metrics-grid">
        <div class="metric-card">
          <div class="metric-icon">ğŸ“</div>
          <div class="metric-value">{{ formatKm(activity.distance) }} km</div>
          <div class="metric-label">Distancia</div>
        </div>
        <div class="metric-card">
          <div class="metric-icon">â±ï¸</div>
          <div class="metric-value">{{ formatTime(activity.movingTime) }}</div>
          <div class="metric-label">Tiempo en movimiento</div>
        </div>
        <div class="metric-card">
          <div class="metric-icon">â›°ï¸</div>
          <div class="metric-value">{{ activity.totalElevationGain }} m</div>
          <div class="metric-label">Desnivel</div>
        </div>
        <div class="metric-card">
          <div class="metric-icon">âš¡</div>
          <div class="metric-value">{{ (activity.averageSpeed * 3.6).toFixed(1) }} km/h</div>
          <div class="metric-label">Velocidad media</div>
        </div>
        <div class="metric-card" *ngIf="activity.averageHeartrate">
          <div class="metric-icon">â¤ï¸</div>
          <div class="metric-value">{{ activity.averageHeartrate }} bpm</div>
          <div class="metric-label">FC media</div>
        </div>
        <div class="metric-card" *ngIf="activity.averageWatts">
          <div class="metric-icon">ğŸ”‹</div>
          <div class="metric-value">{{ activity.averageWatts }} W</div>
          <div class="metric-label">Potencia media</div>
        </div>
        <div class="metric-card" *ngIf="activity.calories">
          <div class="metric-icon">ğŸ”¥</div>
          <div class="metric-value">{{ activity.calories }} kcal</div>
          <div class="metric-label">CalorÃ­as</div>
        </div>
        <div class="metric-card">
          <div class="metric-icon">ğŸï¸</div>
          <div class="metric-value">{{ (activity.maxSpeed * 3.6).toFixed(1) }} km/h</div>
          <div class="metric-label">Velocidad mÃ¡xima</div>
        </div>
      </div>

      <!-- Mapa -->
      <div class="map-card" *ngIf="activity.summaryPolyline">
        <h2>Ruta</h2>
        <div id="map"></div>
      </div>

      <div class="no-map" *ngIf="!activity.summaryPolyline">
        <p>ğŸ—ºï¸ Esta actividad no tiene ruta guardada</p>
      </div>

    </div>

    <!-- Actividad no encontrada -->
    <div class="not-found" *ngIf="!isLoading && !activity">
      <p>Actividad no encontrada</p>
      <a routerLink="/activities">Volver a actividades</a>
    </div>

  </main>
</div>
