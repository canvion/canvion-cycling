<div class="layout">

  <!-- Sidebar -->
  <app-sidebar></app-sidebar>

  <!-- Contenido principal -->
  <main class="main">

    <!-- Loading -->
    <app-spinner *ngIf="isLoading"></app-spinner>

    <div *ngIf="!isLoading && activity">

      <!-- Header -->
      <div class="top-bar">
        <div class="top-left">
          <button class="btn-back" (click)="goBack()">â† Volver</button>
          <h1>{{ activity.name }}</h1>
        </div>
        <span class="badge">{{ activity.isManual ? 'Manual' : 'Strava' }}</span>
      </div>

      <!-- Info bÃ¡sica -->
      <div class="info-bar">
        <span>{{ getIcon(activity.type) }} {{ activity.type }}</span>
        <span>ğŸ“… {{ activity.startDate | date:'dd/MM/yyyy HH:mm' }}</span>
        <span *ngIf="activity.description">ğŸ“ {{ activity.description }}</span>
      </div>

      <!-- MÃ©tricas principales -->
      <div class="metrics-grid">
        <div class="metric-card">
          <div class="metric-icon">ğŸ“</div>
          <div class="metric-value">{{ formatKm(activity.distance) }} km</div>
          <div class="metric-label">Distancia</div>
        </div>
        <div class="metric-card">
          <div class="metric-icon">â±ï¸</div>
          <div class="metric-value">{{ formatTime(activity.movingTime) }}</div>
          <div class="metric-label">Tiempo en movimiento</div>
        </div>
        <div class="metric-card">
          <div class="metric-icon">â›°ï¸</div>
          <div class="metric-value">{{ activity.totalElevationGain }} m</div>
          <div class="metric-label">Desnivel</div>
        </div>
        <div class="metric-card">
          <div class="metric-icon">âš¡</div>
          <div class="metric-value">{{ (activity.averageSpeed * 3.6).toFixed(1) }} km/h</div>
          <div class="metric-label">Velocidad media</div>
        </div>
        <div class="metric-card" *ngIf="activity.averageHeartrate">
          <div class="metric-icon">â¤ï¸</div>
          <div class="metric-value">{{ activity.averageHeartrate }} bpm</div>
          <div class="metric-label">FC media</div>
        </div>
        <div class="metric-card" *ngIf="activity.averageWatts">
          <div class="metric-icon">ğŸ”‹</div>
          <div class="metric-value">{{ activity.averageWatts }} W</div>
          <div class="metric-label">Potencia media</div>
        </div>
        <div class="metric-card" *ngIf="activity.calories">
          <div class="metric-icon">ğŸ”¥</div>
          <div class="metric-value">{{ activity.calories }} kcal</div>
          <div class="metric-label">CalorÃ­as</div>
        </div>
        <div class="metric-card">
          <div class="metric-icon">ğŸï¸</div>
          <div class="metric-value">{{ (activity.maxSpeed * 3.6).toFixed(1) }} km/h</div>
          <div class="metric-label">Velocidad mÃ¡xima</div>
        </div>
      </div>

      <!-- MÃ©tricas adicionales -->
      <div class="extra-metrics" *ngIf="activity.averageCadence || activity.sufferScore || activity.averageTemp">
        <h2>MÃ©tricas adicionales</h2>
        <div class="extra-grid">

          <!-- Cadencia -->
          <div class="extra-card" *ngIf="activity.averageCadence">
            <div class="extra-icon">ğŸ”„</div>
            <div class="extra-value">{{ activity.averageCadence }} rpm</div>
            <div class="extra-label">Cadencia media</div>
            <div class="extra-badge" [class]="getCadenceClass(activity.averageCadence)">
              {{ getCadenceLabel(activity.averageCadence) }}
            </div>
          </div>

          <!-- Suffer Score -->
          <div class="extra-card" *ngIf="activity.sufferScore">
            <div class="extra-icon">ğŸ’ª</div>
            <div class="extra-value">{{ activity.sufferScore }}</div>
            <div class="extra-label">Esfuerzo (Suffer Score)</div>
            <div class="extra-badge" [class]="getSufferClass(activity.sufferScore)">
              {{ getSufferLabel(activity.sufferScore) }}
            </div>
          </div>

          <!-- Temperatura -->
          <div class="extra-card" *ngIf="activity.averageTemp">
            <div class="extra-icon">{{ getTempIcon(activity.averageTemp) }}</div>
            <div class="extra-value">{{ activity.averageTemp }}Â°C</div>
            <div class="extra-label">Temperatura</div>
            <div class="extra-badge" [class]="getTempClass(activity.averageTemp)">
              {{ getTempLabel(activity.averageTemp) }}
            </div>
          </div>

        </div>
      </div>

      <!-- Mapa -->
      <div class="map-card" *ngIf="activity.summaryPolyline">
        <h2>Ruta</h2>
        <div id="map"></div>
      </div>

      <div class="no-map" *ngIf="!activity.summaryPolyline">
        <p>ğŸ—ºï¸ Esta actividad no tiene ruta guardada</p>
      </div>

    </div>

    <!-- Actividad no encontrada -->
    <div class="not-found" *ngIf="!isLoading && !activity">
      <p>Actividad no encontrada</p>
      <a routerLink="/activities">Volver a actividades</a>
    </div>

  </main>
</div>
